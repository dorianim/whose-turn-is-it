<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script src="index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <main class="container">
        <div x-data>
            <div x-show="$store.localState.joined">
                <hgroup>
                    <h1
                        x-text="'Currently playing: ' + ($store.remoteState.isMyTurn ? 'YOU!':$store.remoteState.players[$store.remoteState.currentPlayer])">
                    </h1>
                    <h2 x-text="'You are ' + $store.localState.name"></h2>
                </hgroup>

                <div x-data="Timer">
                    <p :class="'timer' + ($store.remoteState.isMyTurn ? ' my-turn':'') + (time < 0 ? ' over':'')"
                        x-text="time + 's'"></p>
                </div>

                <button @click="$store.remoteState.giveTurnToNextPlayer()"
                    x-bind:disabled="$store.remoteState.currentPlayer !== $store.localState.id">I'm done!</button>

                <label for="nextPlayer_select">Player after me: <b
                        x-text="$store.remoteState.players[$store.localState.nextPlayer]"></b> </label>
                <select x-model="$store.localState.nextPlayer" id="nextPlayer_select">
                    <template
                        x-for="playerId in Object.keys($store.remoteState.players).filter(id => id != $store.localState.id)"
                        :key="playerId">
                        <option x-bind:value="playerId" x-text="$store.remoteState.players[playerId]"></option>
                    </template>
                </select>

                <fieldset>
                    <label for="sound_enabled">
                        <input x-model="$store.audio.isEnabled" @click="$store.audio.testPermission()" type="checkbox" id="sound_enabled" name="sound_enabled" role="switch">
                        Enable sound
                    </label>
                </fieldset>

                <div class="grid">
                    <button class="secondary outline" @click="$store.localState.leave()">Leave</button>
                    <button class="secondary outline" @click="$store.remoteState.clear()">Clear</button>
                </div>

                <p>Other players:</p>
                <ul>
                    <template x-for="playerId in Object.keys($store.remoteState.players)" :key="playerId">
                        <li x-text="$store.remoteState.players[playerId]"></li>
                    </template>
                </ul>

            </div>
            <div x-show="!$store.localState.joined">
                <form x-data="JoinForm()" @submit.prevent="submitForm">
                    <input type="text" x-model="formData.name" placeholder="Name">
                    <button type="submit">Join</button>
                </form>
            </div>
        </div>
    </main>
</body>

</html>